library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
lendc=read.csv("accepted_2007_to_2018Q4.csv")
lendc=read.csv(file="accepted_2007_to_2018Q4.csv")
lendc=read.csv(file = "accepted_2007_to_2018Q4.csv")
lendc=read.csv(file = "data\accepted_2007_to_2018Q4.csv")
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
head(lendc)
help(lendc)
lendc$issue_d=as.Date(lendc$issue_d,format="%m-%Y")
lendclub=lendc%>%
filter(issue_d>="Jan-2012")
head(lendc$issue_d)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
glimpse(lendc)
head(lendc)
lendc$issue_d=as.character(lendc$issue_d)
lendc$issue_d=as.Date(lendc$issue_d,format="%m-%Y")
lendclub=lendc%>%
filter(issue_d>="Jan-2012")
lendc$issue_d
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv",stringsAsFactors = FALSE)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv",stringsAsFactors = FALSE)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
head(lendc)
lendc$issue_date=my(lendc$issue_d)
lendc$issue_date=parse_date_time(lendc$issue_d,"my")
lendc$issue_date
lendclub=lendc%>%
filter(issue_date>="2012-01-01")
head(lendclub)
head(lendclub)
lendclub=lendclub%>%
select(-id,-member_id,-lendc)
lendclub=lendclub%>%
select(-id,-member_id,-issue_d)
# Removing columns with more then 40% NA values.
lendclub=lendclub[,which(colMeans(is.na(lendclub))>0.4)]
# Exporting csv file.
write.csv(lendclub,"\data\lendclub.csv",row.names=FALSE)
# Exporting csv file.
write.csv(lendclub,"data\lendclub.csv",row.names=FALSE)
# Exporting csv file.
write.csv(lendclub,"D:\Spring 2020\STAT 652\GHAURI_BASIL_STAT652_PROJECT\lendclub.csv",row.names=FALSE)
# Exporting csv file.
write.csv(read.csv,file = "lendclub.csv")
# Exporting csv file.
write.csv(lendclub,"D:\Spring 2020\STAT 652\GHAURI_BASIL_STAT652_PROJECT\\lendclub.csv",row.names=FALSE)
# Exporting csv file.
write.csv(lendclub,"D:\\Spring 2020\\STAT 652\\GHAURI_BASIL_STAT652_PROJECT\\Lending Club.csv",row.names=FALSE)
library(tidyverse)
library(dplyr)
lendclub=read.csv(file = "data\Lending Club.csv")
lendclub=read.csv(file = "data\Lending Club.csv")
lendclub=read.csv(file = "data\Lending Club.csv")
lendclub=read.csv(file = "data\Lending Club.csv")
lendclub=read.csv(file = "data/Lending Club.csv")
head(lendclub)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
head(lendc)
lendc$issue_date=parse_date_time(lendc$issue_d,"my")
lendclub=lendc%>%
filter(issue_date>="2012-01-01")
head(lendclub)
lendclub=lendclub%>%
select(-id,-member_id,-issue_d)
# Removing columns with more then 40% NA values.
lendclub=lendclub[,-which(colMeans(is.na(lendclub))>0.4)]
# Exporting csv file.
write.csv(lendclub,"D:\\Spring 2020\\STAT 652\\GHAURI_BASIL_STAT652_PROJECT\\Lending Club.csv",row.names=FALSE)
library(tidyverse)
library(dplyr)
lendclub=read.csv(file = "data/Lending Club.csv")
head(lendclub)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
head(lendc)
lendc$issue_date=parse_date_time(lendc$issue_d,"my")
lendc$issue_date=parse_date_time(lendc$issue_d,"my")
lendclub=lendc%>%
filter(issue_date>="2012-01-01"&issue_date<=2015-12-01)
lendc$issue_date=parse_date_time(lendc$issue_d,"my")
lendc$issue_date
lendclub=lendc%>%
filter(issue_date>="2012-01-01"&issue_date<="2015-12-01")
head(lendclub)
lendclub=lendclub%>%
select(-id,-member_id,-issue_d,-url,-zip_code)
# Removing columns with more then 25% NA values.
lendclub=lendclub[,-which(colMeans(is.na(lendclub))>0.25)]
# Exporting csv file.
write.csv(lendclub,"D:\\Spring 2020\\STAT 652\\GHAURI_BASIL_STAT652_PROJECT\\Lending Club.csv",row.names=FALSE)
library(tidyverse)
library(dplyr)
lendclub=read.csv(file = "data/Lending Club.csv")
library(tidyverse)
library(dplyr)
lendclub=read.csv(file = "data/Lending Club.csv")
head(lendclub)
table(lendclub$term)
table(lendclub$home_ownership)
table(lendclub$recoveries)
table(lendclub$issue_date)
table(lendclub$loan_status)
head(lendc)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
library(pacman)
library(Amelia)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
library(pacman)
library(Amelia)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
# Putting NA values in empty spaces
lendc[lendc==""]=NA
head(lendc)
# Removing columns with more then 25% NA values.
lendclub=lendclub[,-which(colMeans(is.na(lendclub))>0.10)]
# Removing columns with more then 25% NA values.
lendc=lendc[,-which(colMeans(is.na(lendc))>0.10)]
head(lendc)
lendc$issue_date=parse_date_time(lendc$issue_d,"my")
lendclub=lendc%>%
filter(issue_date>="2012-01-01"&issue_date<="2015-12-01")
head(lendclub)
table(lendclub$loan_status)
lendclu=lendclub%>%
subset(loan_status=="Charged off"|loan_status=="Fully Paid")
table(lendclu$loan_status)
lendclu=lendclub%>%
subset(loan_status=="Charged off"&loan_status=="Fully Paid")
lendclu=lendclub%>%
subset(loan_status=="Charged off"||loan_status=="Fully Paid")
table(lendclu$loan_status)
lendclu=lendclub%>%
filter(loan_status=="Charged off"||loan_status=="Fully Paid")
table(lendclu$loan_status)
lendclu=lendclub%>%
filter(loan_status=="Charged off"&loan_status=="Fully Paid")
lendclu=lendclub%>%
filter(loan_status=="Charged off"|loan_status=="Fully Paid")
table(lendclu$loan_status)
table(lendclub$loan_status)
table(lendclub$loan_status)
lendclu=lendclub%>%
filter(lendclub%in%c("Charged off","Fully Paid"))
View(lendc)
head(lendclub)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
library(pacman)
library(Amelia)
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
library(pacman)
library(Amelia)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
# Putting NA values in empty spaces
lendc[lendc==""]=NA
head(lendc)
head(lendclub)
# Removing columns with more then 25% NA values.
lendc=lendc[,-which(colMeans(is.na(lendc))>0.10)]
# Removing columns with more then 25% NA values.
lendclub=lendc[,-which(colMeans(is.na(lendc))>0.10)]
# Removing columns with more then 25% NA values.
lendc=lendc[,-which(colMeans(is.na(lendc))>0.10)]
head(lendc)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(lubridate)
library(pacman)
library(Amelia)
lendc=read.csv(file = "data/accepted_2007_to_2018Q4.csv")
# Putting NA values in empty spaces
lendc[lendc==""]=NA
head(lendc)
# Removing columns with more then 25% NA values.
lendc=lendc[,-which(colMeans(is.na(lendc))>0.10)]
lendc$issue_date=parse_date_time(lendc$issue_d,"my")
lendclub=lendc%>%
filter(issue_date>="2012-01-01"&issue_date<="2015-12-01")
head(lendclub)
table(lendclub$loan_status)
lendclu=lendclub%>%
filter(lendclub%in%c("Charged off","Fully Paid"))
lendclu=lendclub%>%
filter(loan_status%in%c("Charged off","Fully Paid"))
table(lendclu$loan_status)
glimpse(lendclu)
lendclub$loan_status[1:10]
lendclub$loan_status[10:20]
lendclub$loan_status[20:30]
lendclu=lendclub%>%
subset(loan_status=="Fully Paid")
count(lendclub$loan_status=="Charged off")
lendclub%>%
select(loan_status)%>%
group_by(loan_status)%>%
summarise(n=n())
lendclu=lendclub%>%
subset(loan_status=="Charged Off")
lendclu=lendclub%>%
subset(loan_status=="Fully Paid"|loan_status=="Charged Off")
table(lendclu$loan_status)
lendclu%>%
select(loan_status)%>%
group_by(loan_status)%>%
summarise(n=n())
lendclub%>%
select(loan_status)%>%
group_by(loan_status)%>%
summarise(n=n())
lendclub=lendclub%>%
subset(loan_status=="Fully Paid"|loan_status=="Charged Off")
lendclub%>%
select(loan_status)%>%
group_by(loan_status)%>%
summarise(n=n())
removing useless columns
lendclub[10:20]
lendclub$loan_status[10:20]
lendclub$loan_status[1:10]
lendclub$loan_status[10:20]
lendclub=lendclub%>%
mutate(loan_status=ifelse(loan_status=="Charged Off",0,1))
lendclub$loan_status[10:20]
glimpse(lendclub)
lendclub=lendclub%>%
select(-id,zip_code,-url,-pymnt_plan,-addr_state,-disbursement_method,-last_pymnt_d,-initial_list_status,-emp_title,-emp_length,-grade)
lendclub=lendclub%>%
select(-id,zip_code,-url,-pymnt_plan,-addr_state,-disbursement_method,-last_pymnt_d,-initial_list_status,-emp_title,-emp_length,-grade)
table(lendclub$)
ncol(lendclub)
nrow(lendclub)
# Exporting csv file.
write.csv(lendclub,"D:\\Spring 2020\\STAT 652\\GHAURI_BASIL_STAT652_PROJECT\\Lending Club.csv",row.names=FALSE)
library(tidyverse)
library(dplyr)
library(knitr)
library(caret)
library(tidyverse)
library(dplyr)
library(knitr)
library(caret)
lendclub=read.csv(file = "data/Lending Club.csv")
head(lendclub)
# Removing NA values
lendclub=na.omit(lendclub)
# Removing NA values
lendclub=na.omit(lendclub)
# Keeping variables with 1 unique value
imp <- c()
unique_vals <- sapply(lendclub, function(x) length(unique(x)))
for(key in names(unique_vals)){
value<-unique_vals[key]
if(value > 1) {
imp <- append(imp,key)
}
}
lendclub=lendclub[imp]
# Cleanin the data
imp2<- c()
complete<-sapply(lendclub,function(x) sum(!is.na(x))/length(x))
for(key in names(complete)){
val<- complete[key]
if(val>=0.75){
imp2<-append(imp2,key)
}
}
lendclub<-lendclub[imp2]
dim(lendclub)
# Removing all NAs from Dataset
lendclub=na.omit(lendclub)
# Removing Factors from dataset
library(taRifx)
lendclub2=remove.factors(lendclub)
lendclub2=lendclub2[,-which(sapply(lendclub2,class)== "character")]
# Removing Factors and Character columns from dataset
library(taRifx)
lendclub2=remove.factors(lendclub)
lendclub2=lendclub2[,-which(sapply(lendclub2,class)== "character")]
# Taking a sample of 30,000.
set.seed(1234)
lendclub3=lendclub2[sample(nrow(lendclub2),30000),]
library(randomForest)
rf_model=randomForest(loan_status~.,data=lendclub3,ntree=201,mtry=3)
importance(rf_model)
# Cleaning Data Further
lendclub4=lendclub2%>%
select(-total_pymnt,-total_pymnt_inv,-recoveries,-collection_recovery_fee,-last_pymnt_amnt,-last_fico_range_high,-last_fico_range_low,-total_rec_prncp,-funded_amnt_inv)
# Cleaning the Data Further by individually selecting the Predictor Variables.
lendclub4=lendclub2%>%
select(-total_pymnt,-total_pymnt_inv,-recoveries,-collection_recovery_fee,-last_pymnt_amnt,-last_fico_range_high,-last_fico_range_low,-total_rec_prncp,-funded_amnt_inv)
lendclub5=lendclub4[sample(nrow(lendclub4),300000),]
lendclub5=lendclub4[sample(nrow(lendclub4),300000),]
# Setup Train and Test Dataset
indx=sample(1:nrow(lendclub5),as.integer(0.8*nrow(lendclub5)))
lendclub_train=lendclub5[indx,]
lendclub_test=lendclub5[-indx,]
# Setup Train and Test Dataset
indx=sample(1:nrow(lendclub5),as.integer(0.75*nrow(lendclub5)))
lendclub_train=lendclub5[indx,]
lendclub_test=lendclub5[-indx,]
lr_model=glm(loan_status~.,family = binomial(link = "logit"),data = lendclub_train)
summary(lr_model)
pred_regression=predict(lr_model,newdata = lendclub_test,type = "response")
pred_regression=ifelse(pred_regression>0.5,1,0)
t1=table(lendclub_test$loan_status,pred_regression)
t1
prop.table(t1)
sum(diag(t1))/sum(t1)
lr_model2=glm(loan_status~loan_amnt+int_rate+installment+annual_inc+dti+delinq_2yrs+inq_last_6mths+open_acc+revol_bal+total_rec_int+total_rec_late_fee+collections_12_mths_ex_med+acc_open_past_24mths+avg_cur_bal+bc_open_to_buy+bc_util+mo_sin_old_il_acct+mo_sin_rcnt_tl+mort_acc +mths_since_recent_bc+num_accts_ever_120_pd+num_actv_rev_tl+num_rev_tl_bal_gt_0+num_sats+pct_tl_nvr_dlq+percent_bc_gt_75+tot_hi_cred_lim+total_bal_ex_mort+total_bc_limit+total_il_high_credit_limit,family = binomial(link = "logit"),data = lendclub_train)
summary(lr_model2)
pred_regression2=predict(lr_model,newdata = lendclub_test,type = "response")
pred_regression2=ifelse(pred_regression2>0.5,1,0)
t2=table(lendclub_test$loan_status,pred_regression2)
t2
prop.table(t2)
sum(diag(t2))/sum(t2)
lr_model2=glm(loan_status~loan_amnt+int_rate+installment+dti+delinq_2yrs+inq_last_6mths+open_acc+revol_bal+total_rec_int+total_rec_late_fee+collections_12_mths_ex_med+acc_open_past_24mths+avg_cur_bal+bc_util+mo_sin_rcnt_tl+mort_acc +mths_since_recent_bc+num_actv_rev_tl+num_rev_tl_bal_gt_0+num_sats+percent_bc_gt_75+tot_hi_cred_lim+total_bal_ex_mort+total_bc_limit+total_il_high_credit_limit,family = binomial(link = "logit"),data = lendclub_train)
summary(lr_model2)
pred_regression2=predict(lr_model,newdata = lendclub_test,type = "response")
pred_regression2=ifelse(pred_regression2>0.5,1,0)
t2=table(lendclub_test$loan_status,pred_regression2)
t2
prop.table(t2)
sum(diag(t2))/sum(t2)
